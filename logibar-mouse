#!/bin/bash
# Logitech PRO X Superlight 2 Battery Widget for Waybar

STATE_FILE="${XDG_RUNTIME_DIR:-/run/user/$UID}/logibar/mouse"
ICON="󰍽"
ICON_CHARGING="󰍽 ⚡"
TOOLTIP="PRO X Superlight 2"

# Default colors (One Dark)
COLOR_NORMAL="#98c379"
COLOR_WARNING="#e5c07b"
COLOR_CRITICAL="#e06c75"

if [[ ! -f "$STATE_FILE" ]]; then
    echo '{"text": ""}'
    exit 0
fi

BATTERY=$(sed -n '1p' "$STATE_FILE")
CONNECTED=$(sed -n '2p' "$STATE_FILE")
CHARGING=$(sed -n '3p' "$STATE_FILE")

if [[ -z "$BATTERY" ]] || [[ "$BATTERY" == "0" ]] || [[ "$CONNECTED" != "1" ]]; then
    echo '{"text": ""}'
    exit 0
fi

if [[ $BATTERY -le 10 ]]; then
    CLASS="critical"; COLOR="$COLOR_CRITICAL"
elif [[ $BATTERY -le 20 ]]; then
    CLASS="warning"; COLOR="$COLOR_WARNING"
else
    CLASS="normal"; COLOR="$COLOR_NORMAL"
fi

if [[ "$CHARGING" == "1" ]]; then
    DISPLAY_ICON="$ICON_CHARGING"
    TOOLTIP_STATUS="$TOOLTIP: $BATTERY% (charging)"
else
    DISPLAY_ICON="$ICON"
    TOOLTIP_STATUS="$TOOLTIP: $BATTERY%"
fi

echo "{\"text\": \"$DISPLAY_ICON <span size='small' foreground='${COLOR}'>$BATTERY%</span>\", \"tooltip\": \"$TOOLTIP_STATUS\", \"class\": \"$CLASS\", \"percentage\": $BATTERY}"
